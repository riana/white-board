<!DOCTYPE html>
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="./linked-graph.html">

<dom-module id="d3-board">

   <template>
      <style is="custom-style">
         :host {
            display: block;
         }

         #d3Board {
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
         }
      </style>

      <iron-ajax auto url="/elements/d3-board/test.json" handle-as="json" on-response="handleResponse" debounce-duration="300"></iron-ajax>

      <div id="d3Board">
      </div>
   </template>

   <script>
      "use strict";
      Polymer({
         is: "d3-board",
         ready() {
            this.linkedGraph = new LinkedGraph("#d3Board");
            this.linkedGraph.pencilFilter = false;
         },
         handleResponse(e) {
            let data = e.detail.response;
            this.linkedGraph.updateGraph(data);
            let updateCounter = 0;
            let updateTask = setInterval(() => {
               data.nodes[0].x = data.nodes[0].x + 40;
               updateCounter++;

               if (updateCounter == 5) {
                  data.nodes.push({
                     id: "2",
                     text: "new Node",
                     x: 100,
                     y: 250
                  })

                  data.links.push({
                     source: "1",
                     target: "2"
                  });
               }

               if (updateCounter >= 10) {

                  data.nodes.splice(0, 1);
                  data.links.splice(0, 1);
               }
               if (updateCounter >= 10) {
                  clearInterval(updateTask);
               }
               this.linkedGraph.updateGraph(data);
            }, 100);
         }

      });
   </script>

</dom-module>
